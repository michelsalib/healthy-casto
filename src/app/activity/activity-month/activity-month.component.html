<ng-container *ngIf="dataset$ | async as dataset">

    <h2 class="name">
        {{ month | date:'MMMM yyyy' | titlecase }}
    </h2>

    <div class="calendar">
        <div class="title">
            <div></div>
            <div></div>
            <div *ngFor="let objective of dataset.objectives">
                <strong>{{ objective.name }}</strong>
            </div>
        </div>

        <div class="days" #daysContainer>
            <div *ngFor="let day of dataset.days" class="day" [ngClass]="{ monday: isMonday(day), today: isToday(day) }">
                <div class="day-letter">
                    {{ day | date:'EEEEE' }}
                </div>
                <div class="day-number">
                    {{ day | date:'dd' }}
                </div>
                <div class="day-objective" *ngFor="let objective of dataset.objectives">

                    <mat-select *ngIf="!userId; else readonlyTemplate" [value]="dataset.activity[day]?.[objective.id]"
                        (valueChange)="setActivity($event, day, objective.id)" draggable="true"
                        (dragstart)="dragStart($event, dataset.activity[day]?.[objective.id], day, objective.id)"
                        (drop)="drop($event, objective.id, day)" (dragenter)="dragEnter($event, objective.id, day)"
                        (dragover)="dragOver($event, objective.id)" [ngClass]="dataset.activity[day]?.[objective.id]"
                        [class.edited]="editedDays.includes(day) && objective.id == dragData?.objectiveId">
                        <mat-option [value]="undefined">-</mat-option>
                        <mat-option value="ðŸŸ¥">{{ objective.failure }}</mat-option>
                        <mat-option value="ðŸŸ§">{{ objective.average }}</mat-option>
                        <mat-option value="ðŸŸ©">{{ objective.success }}</mat-option>
                    </mat-select>

                    <ng-template #readonlyTemplate>
                        <div class="readonly" [ngClass]="dataset.activity[day]?.[objective.id]">
                            {{ getIcon(objective, dataset.activity[day]?.[objective.id]) }}
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>

        <div class="recap">
            <div></div>
            <div></div>
            <div *ngFor="let config of dataset.objectiveConfigs">
                <ng-container *ngIf="computeScore(month, config, dataset.activity, dataset.days.length) as score">
                    {{ score.emoji }} {{ score.score }} / <strong>{{ config.target | label:'short' }}</strong>
                </ng-container>
            </div>
        </div>
    </div>

    <mat-divider></mat-divider>

</ng-container>